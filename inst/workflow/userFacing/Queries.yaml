meta:
  Type: User
  ID: Queries
  Description: Query User-Facing Data
  Priority: 2
spec:
  Raw_QUERY:
    subject_nsv:
      required: true
      type: character
      source_col: subjectname
    visit:
      required: false
      type: character
    form:
      required: false
      type: character
      source_col: formoid
    field:
      required: false
      type: character
      source_col: fieldoid
    query_status:
      required: true
      type: character
      source_col: querystatus
    query_age:
      required: true
      type: numeric
      source_col: queryage
  Mapped_SUBJ:
    subjid:
      required: true
      type: character
    subject_nsv:
      required: true
      type: character
steps:
  # Merge [ subjid ] onto EDC domains.
  - output: Temp_SubjectLookup
    name: select
    params:
      .data: Mapped_SUBJ
      SubjectID: subjid
      subject_nsv: subject_nsv
  - output: Temp_User_QUERY
    name: right_join
    params:
      x: Temp_SubjectLookup
      "y": Raw_QUERY
      by: subject_nsv
  - output: User_QUERY
    name: $<-
    params:
      lhs: Temp_User_QUERY
      name: subject_nsv
      value: NULL
